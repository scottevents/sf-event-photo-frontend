<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>V2 — Minimal Grid | Project - SF Event Photo</title>
    <meta name="description" id="meta-description" content="Event photography gallery by SF Event Photo - Professional event photography in San Francisco and Los Angeles">
    <meta name="robots" content="index, follow">
    <meta name="author" content="SF Event Photo">
    
    <!-- Open Graph (will be updated dynamically) -->
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="SF Event Photo">
    <meta property="og:title" id="og-title" content="SF Event Photo">
    <meta property="og:description" id="og-description" content="Event photography gallery">
    <meta property="og:image" id="og-image" content="">
    <meta property="og:url" id="og-url" content="">
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" id="twitter-title" content="SF Event Photo">
    <meta name="twitter:description" id="twitter-description" content="Event photography gallery">
    <meta name="twitter:image" id="twitter-image" content="">
    
    <!-- Schema.org ImageGallery (will be populated dynamically) -->
    <script type="application/ld+json" id="schema-data">
    {
        "@context": "https://schema.org",
        "@type": "ImageGallery",
        "name": "Event Gallery",
        "description": "Event photography by SF Event Photo",
        "provider": {
            "@type": "ProfessionalService",
            "name": "SF Event Photo",
            "url": "https://sfeventphoto.com"
        }
    }
    </script>
    
    <!-- Preconnect to image CDN -->
    <link rel="preconnect" href="https://imagedelivery.net" crossorigin>
    <link rel="preconnect" href="https://sf-event-photo-backend.vercel.app">
    <link rel="dns-prefetch" href="https://imagedelivery.net">
    
    <!-- Preload critical font -->
    <link rel="preload" href="./fonts/PPNeueYork-NormalRegular.woff2" as="font" type="font/woff2" crossorigin>
    
    <style>
        /* PP Neue York Font Family */
        @font-face {
            font-family: 'PP Neue York';
            src: url('./fonts/PPNeueYork-NormalThin.woff2') format('woff2'),
                 url('./fonts/PPNeueYork-NormalThin.woff') format('woff');
            font-weight: 100;
            font-style: normal;
            font-display: swap;
        }
        @font-face {
            font-family: 'PP Neue York';
            src: url('./fonts/PPNeueYork-NormalLight.woff2') format('woff2'),
                 url('./fonts/PPNeueYork-NormalLight.woff') format('woff');
            font-weight: 300;
            font-style: normal;
            font-display: swap;
        }
        @font-face {
            font-family: 'PP Neue York';
            src: url('./fonts/PPNeueYork-NormalRegular.woff2') format('woff2'),
                 url('./fonts/PPNeueYork-NormalRegular.woff') format('woff');
            font-weight: 400;
            font-style: normal;
            font-display: swap;
        }
        @font-face {
            font-family: 'PP Neue York';
            src: url('./fonts/PPNeueYork-NormalMedium.woff2') format('woff2'),
                 url('./fonts/PPNeueYork-NormalMedium.woff') format('woff');
            font-weight: 500;
            font-style: normal;
            font-display: swap;
        }

        :root {
            --black: #1a1a1a;
            --white: #ffffff;
            --gray-light: #f8f8f8;
            --gray-mid: #e8e8e8;
            --gray-dark: #888888;
            --accent: #1a1a1a;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'PP Neue York', Georgia, serif;
            color: var(--black);
            background: var(--white);
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
        }
        
        /* ═══════════════════════════════════════
           HEADER
           ═══════════════════════════════════════ */
        .header {
            position: sticky; top: 0;
            background: #0a0a0a; z-index: 1000;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .header-inner {
            display: flex; justify-content: space-between;
            align-items: center; padding: 1.25rem 1.5rem;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .hamburger {
            display: none;
            background: none;
            border: none;
            cursor: pointer;
            padding: 0.25rem;
        }

        .hamburger svg {
            width: 24px;
            height: 24px;
            stroke: #e0e0e0;
            stroke-width: 1.5;
        }

        .logo {
            font-size: 0.9rem; font-weight: 400;
            letter-spacing: 0.08em; text-decoration: none; color: #e0e0e0;
        }

        .nav { display: flex; gap: 2.5rem; align-items: center; }

        .nav-links {
            display: flex;
            gap: 2.5rem;
            align-items: center;
        }

        .nav a {
            text-decoration: none; color: #e0e0e0;
            font-size: 0.85rem; font-weight: 400;
            letter-spacing: 0.1em; text-transform: uppercase;
            transition: opacity 0.2s;
        }

        .nav a:hover { opacity: 0.5; }

        .nav-actions {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .cart-link { position: relative; display: flex; align-items: center; text-decoration: none; }
        .cart-link svg { width: 24px; height: 24px; stroke-width: 1.5; }

        .cart-badge {
            position: absolute; top: -6px; right: -10px;
            background: #e53935; color: white;
            font-size: 0.65rem; font-weight: 500;
            min-width: 18px; height: 18px; border-radius: 50%;
            display: none; align-items: center; justify-content: center;
        }

        .cart-badge.show { display: flex; }

        .auth-link {
            text-decoration: none; color: #e0e0e0;
            font-size: 0.85rem; font-weight: 400;
            letter-spacing: 0.1em; text-transform: uppercase; transition: opacity 0.2s;
        }

        .auth-link:hover { opacity: 0.5; }

        /* Mobile menu overlay */
        .mobile-menu {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: var(--white);
            z-index: 2000;
            flex-direction: column;
            padding: 1.5rem;
        }

        .mobile-menu.open { display: flex; }

        .mobile-menu-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 3rem;
        }

        .mobile-menu-close {
            background: none; border: none;
            cursor: pointer; padding: 0.25rem;
        }

        .mobile-menu-close svg {
            width: 28px; height: 28px;
            stroke: var(--black); stroke-width: 1.5;
        }

        .mobile-menu-links {
            display: flex;
            flex-direction: column;
            gap: 0;
        }

        .mobile-menu-links a {
            display: block;
            padding: 1.25rem 0;
            text-decoration: none;
            color: var(--black);
            font-size: 1.25rem;
            font-weight: 400;
            letter-spacing: 0.05em;
            border-bottom: 1px solid var(--gray-mid);
        }

        .mobile-menu-links a:first-child {
            border-top: 1px solid var(--gray-mid);
        }

        @media (max-width: 768px) {
            .hamburger { display: block; }
            .nav-links { display: none; }
            .nav { gap: 1.5rem; }
            .nav-actions { gap: 1.25rem; }
            .auth-link { font-size: 0.75rem; }
        }

        /* User Menu */
        .user-menu { position: relative; }

        .user-menu-btn {
            background: none; border: none; cursor: pointer;
            display: flex; align-items: center; gap: 0.4rem;
            font-family: 'PP Neue York', Georgia, serif;
            font-size: 0.85rem; font-weight: 400;
            letter-spacing: 0.1em; text-transform: uppercase;
            color: #e0e0e0; padding: 0; transition: opacity 0.2s;
        }

        .user-menu-btn:hover { opacity: 0.5; }
        .user-menu-btn svg { width: 20px; height: 20px; stroke-width: 1.5; }

        .user-dropdown {
            position: absolute; top: calc(100% + 10px); right: 0;
            background: var(--white); border: 1px solid var(--gray-mid);
            min-width: 200px; display: none; z-index: 100;
        }

        .user-dropdown.show { display: block; }

        .user-dropdown a, .user-dropdown button {
            display: block; width: 100%; padding: 1rem 1.25rem;
            text-align: left; font-family: 'PP Neue York', Georgia, serif;
            font-size: 0.85rem; font-weight: 400; letter-spacing: 0.05em;
            text-transform: uppercase; text-decoration: none;
            color: var(--black); background: none; border: none;
            border-bottom: 1px solid var(--gray-mid);
            cursor: pointer; transition: background 0.2s;
        }

        .user-dropdown a:hover, .user-dropdown button:hover { background: var(--gray-light); }
        .user-dropdown .signout-btn { background: var(--black); color: var(--white); border: none; }
        .user-dropdown .signout-btn:hover { opacity: 0.9; background: var(--black); }

        .user-dropdown .user-email {
            font-size: 0.7rem; color: rgba(255,255,255,0.7);
            text-transform: none; letter-spacing: 0; margin-top: 0.25rem;
        }
        
        /* Main Content */
        .main {
            padding: 2.5rem 1.5rem;
            background: #fff;
        }
        
        @media (max-width: 900px) {
            .main { padding: 2rem 1.5rem; }
        }
        
        @media (max-width: 600px) {
            .main { padding: 1.5rem 0.75rem; }
        }
        
        /* Footer */
        .footer {
            padding: 3rem 2rem;
            background: var(--black);
            border-top: 1px solid var(--gray-mid);
            margin-top: 4rem;
        }

        .footer-inner {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .footer-left {
            font-size: 0.75rem;
            color: rgba(255,255,255,0.5);
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .footer-left a {
            color: rgba(255,255,255,0.5);
            text-decoration: none;
            transition: color 0.2s;
        }

        .footer-left a:hover {
            color: rgba(255,255,255,0.8);
        }

        .footer-right {
            display: flex;
            gap: 2rem;
        }

        .footer-right a {
            color: rgba(255,255,255,0.7);
            text-decoration: none;
            font-size: 0.8rem;
            transition: color 0.2s;
        }

        .footer-right a:hover {
            color: var(--white);
        }

        @media (max-width: 750px) {
            .footer-inner { 
                flex-direction: column; 
                gap: 1.5rem;
                text-align: center;
            }
            .footer-left { flex-direction: column; gap: 0.5rem; }
        }
        
        /* Password Prompt */
        .password-prompt {
            max-width: 400px;
            margin: 4rem auto;
            text-align: center;
            padding: 3rem 2rem;
        }
        
        .password-prompt-icon {
            width: 64px;
            height: 64px;
            margin: 0 auto 1.5rem;
            background: var(--gray-light);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .password-prompt-icon svg {
            width: 32px;
            height: 32px;
            stroke: var(--gray-dark);
        }
        
        .password-prompt-title {
            font-size: 1.5rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
        }
        
        .password-prompt-subtitle {
            color: var(--gray-dark);
            font-size: 0.95rem;
            margin-bottom: 2rem;
        }
        
        .password-form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .password-input {
            padding: 1rem;
            border: 1px solid var(--gray-mid);
            font-family: 'PP Neue York', Georgia, serif;
            font-size: 1rem;
            text-align: center;
            transition: border-color 0.2s;
        }
        
        .password-input:focus {
            outline: none;
            border-color: var(--black);
        }
        
        .password-input.error {
            border-color: #e53935;
        }
        
        .password-submit {
            padding: 1rem;
            background: var(--black);
            color: white;
            border: none;
            font-family: 'PP Neue York', Georgia, serif;
            font-size: 0.9rem;
            font-weight: 500;
            letter-spacing: 0.05em;
            cursor: pointer;
            transition: opacity 0.2s;
        }
        
        .password-submit:hover {
            opacity: 0.8;
        }
        
        .password-error {
            color: #e53935;
            font-size: 0.85rem;
            min-height: 1.5rem;
            margin-top: 0.5rem;
        }
        
        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
            color: var(--gray-dark);
            text-decoration: none;
            margin-bottom: 1.5rem;
            font-size: 0.9rem;
            font-weight: 300;
            transition: color 0.2s;
        }
        
        .back-link:hover {
            color: var(--black);
        }
        
        .project-header {
            text-align: center;
            padding: 4rem 2rem 2.5rem;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .project-header-top {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 2rem;
            margin-bottom: 1rem;
        }
        
        .project-header-left {
            flex: 1;
        }
        
        .project-date {
            font-size: 0.85rem;
            font-weight: 300;
            color: #999;
            display: inline;
            margin-bottom: 0;
        }
        
        .project-title {
            font-size: clamp(1.5rem, 4vw, 2.5rem);
            font-weight: 400;
            letter-spacing: 0.06em;
            text-transform: uppercase;
            margin-bottom: 0.75rem;
            line-height: 1.15;
        }
        
        .project-venue {
            font-size: 0.85rem;
            font-weight: 300;
            color: #999;
            font-style: normal;
            display: inline;
        }

        .project-meta-sep {
            display: inline;
            color: #ccc;
            margin: 0 0.75rem;
            font-weight: 300;
        }

        .project-credits {
            font-size: 0.85rem;
            font-weight: 300;
            color: var(--black);
            margin-top: 0.75rem;
        }
        
        .project-credits span {
            display: block;
        }
        
        .download-gallery-link {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            color: var(--gray-dark);
            text-decoration: none;
            font-size: 0.85rem;
            padding: 0.75rem 0;
            margin-bottom: -1px;
            margin-left: auto;
            white-space: nowrap;
            flex-shrink: 0;
            transition: color 0.2s;
        }
        
        .download-gallery-link:hover {
            color: var(--black);
        }
        
        .download-gallery-link svg {
            flex-shrink: 0;
        }

        .project-header .download-gallery-link { display: none; }
        .project-header .project-credits { display: none; }
        .project-header-top { display: block; text-align: center; }

        .project-meta {
            color: var(--gray-dark);
            font-size: 0.95rem;
            font-weight: 300;
            display: flex;
            gap: 2rem;
            flex-wrap: wrap;
            margin-top: 0.5rem;
        }
        
        /* Client Code - Minimal */
        .client-code-section {
            display: none;
            flex-direction: column;
            gap: 0.5rem;
            margin-bottom: 2rem;
            padding: 1rem;
            background: #fef2f2;
            border: 1px solid #fecaca;
            border-radius: 6px;
        }
        
        .client-code-section.show {
            display: flex;
        }
        
        .client-code-message {
            font-size: 0.9rem;
            color: #991b1b;
            margin-bottom: 0.5rem;
        }
        
        .client-code-row {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .client-code-input {
            border: 1px solid #d1d5db;
            border-radius: 4px;
            padding: 0.5rem 0.75rem;
            font-family: 'PP Neue York', Georgia, serif;
            font-size: 0.9rem;
            width: 160px;
            background: white;
        }
        
        .client-code-input:focus {
            outline: none;
            border-color: var(--black);
        }
        
        .client-code-input::placeholder {
            color: #9ca3af;
        }
        
        .client-code-submit {
            background: var(--black);
            border: none;
            border-radius: 4px;
            cursor: pointer;
            padding: 0.5rem 1rem;
            color: white;
            font-size: 0.85rem;
            font-weight: 500;
            font-family: 'PP Neue York', Georgia, serif;
        }
        
        .client-code-submit:hover {
            background: #333;
        }
        
        .client-code-status {
            font-size: 0.85rem;
            margin-top: 0.25rem;
        }
        
        .client-code-status.valid {
            color: #10b981;
        }
        
        .client-code-status.invalid {
            color: #ef4444;
        }
        
        /* Download All Photos link - only visible after code entered */
        .download-all-section {
            display: none;
            margin-bottom: 2.5rem;
        }
        
        /* Download All Button - always visible in header area */
        .download-all-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.6rem 1.25rem;
            background: transparent;
            border: 1px solid var(--black);
            color: var(--black);
            font-family: 'PP Neue York', Georgia, serif;
            font-size: 0.85rem;
            font-weight: 400;
            cursor: pointer;
            transition: background 0.2s, color 0.2s;
        }
        
        .download-all-btn:hover {
            background: var(--black);
            color: white;
        }
        
        .download-all-btn svg {
            width: 16px;
            height: 16px;
        }
        
        /* Photos Grid - Minimal Grid layout */
        .photos-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            padding: 0 2rem;
            margin-top: 0;
        }

        .photo-card {
            position: relative;
            overflow: hidden;
            cursor: pointer;
            background: #f5f5f5;
            border-radius: 0;
            aspect-ratio: 3 / 2;
            height: auto;
            contain: layout style paint;
        }

        .photo-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            content-visibility: auto;
        }

        .photo-card:hover .photo-image {
            transform: scale(1.02);
            transition: transform 0.4s ease;
        }

        .photo-card::after {
            content: '';
            position: absolute;
            inset: 0;
            background: rgba(0,0,0,0);
            transition: background 0.3s;
            pointer-events: none;
        }
        .photo-card:hover::after {
            background: rgba(0,0,0,0.1);
        }
        
        @media (max-width: 900px) {
            .photos-grid { grid-template-columns: repeat(3, 1fr); gap: 6px; padding: 0 1rem; }
        }

        @media (max-width: 600px) {
            .photos-grid { grid-template-columns: repeat(2, 1fr); gap: 4px; padding: 0 0.5rem; }
            .photo-card { aspect-ratio: 1 / 1; }
        }
        
        /* Photo action buttons - bottom right corner */
        .photo-actions {
            position: absolute;
            bottom: 10px;
            right: 10px;
            display: flex;
            gap: 8px;
            opacity: 0;
            transition: opacity 0.2s;
            z-index: 10;
        }
        
        .photo-card:hover .photo-actions {
            opacity: 1;
        }
        
        .photo-action-btn {
            width: 28px;
            height: 28px;
            background: none;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            transition: opacity 0.15s;
        }
        
        .photo-action-btn:hover {
            opacity: 0.6;
        }
        
        .photo-action-btn svg {
            width: 22px;
            height: 22px;
            stroke: white;
            fill: none;
            stroke-width: 1.5;
            filter: drop-shadow(0 1px 2px rgba(0,0,0,0.3));
        }
        
        /* Bottom info overlay - names above ID like BFA */
        .photo-info-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent 0%, rgba(0,0,0,0.75) 100%);
            padding: 3.5rem 0.9rem 0.85rem;
        }
        
        .photo-info-name {
            color: white;
            font-size: 0.95rem;
            font-weight: 400;
            line-height: 1.3;
            margin-bottom: 0.25rem;
        }
        
        .photo-info-id {
            color: rgba(255,255,255,0.5);
            font-size: 0.8rem;
            font-weight: 300;
            letter-spacing: 0.03em;
        }
        
        /* Video Cards */
        .video-card {
            position: relative;
            overflow: hidden;
            cursor: pointer;
            background: #1a1a1a;
            border-radius: 4px;
            height: 300px;
            flex: 533 1 533px; /* 16:9 aspect at 300px height */
        }
        
        .video-card .video-thumb {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }
        
        .video-card:hover .video-thumb {
            transform: scale(1.02);
            transition: transform 0.4s ease;
        }
        
        .video-play-btn {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 70px;
            height: 70px;
            background: rgba(0, 0, 0, 0.6);
            border: 2px solid white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            pointer-events: none;
        }
        
        .video-card:hover .video-play-btn {
            background: rgba(0, 0, 0, 0.8);
            transform: translate(-50%, -50%) scale(1.1);
        }
        
        .video-play-btn svg {
            width: 28px;
            height: 28px;
            fill: white;
            margin-left: 4px;
        }
        
        .video-badge {
            position: absolute;
            top: 12px;
            left: 12px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            font-size: 0.7rem;
            font-weight: 500;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            padding: 0.35rem 0.6rem;
            border-radius: 3px;
        }
        
        @media (max-width: 900px) {
            .video-card { height: 280px; flex: 1 1 100%; }
        }
        
        @media (max-width: 600px) {
            .video-card { 
                height: auto;
                flex: 0 0 100%;
            }
            .video-card .video-thumb {
                aspect-ratio: 16/9;
            }
            .video-play-btn {
                width: 60px;
                height: 60px;
            }
            .video-play-btn svg {
                width: 24px;
                height: 24px;
            }
        }
        
        /* Video Modal */
        .video-modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.95);
            z-index: 10000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }
        
        .video-modal.open {
            display: flex;
        }
        
        .video-modal-content {
            position: relative;
            width: 100%;
            max-width: 1200px;
            aspect-ratio: 16/9;
        }
        
        .video-modal-content iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        
        .video-modal-close {
            position: absolute;
            top: -50px;
            right: 0;
            background: none;
            border: none;
            color: white;
            font-size: 2rem;
            cursor: pointer;
            padding: 0.5rem;
            line-height: 1;
        }
        
        .video-modal-close:hover {
            opacity: 0.7;
        }
        
        /* Loading State */
        .loading {
            text-align: center;
            padding: 4rem;
            color: var(--gray-dark);
        }
        
        .loading-spinner {
            border: 3px solid var(--gray-mid);
            border-top: 3px solid var(--black);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 4rem;
            color: var(--gray-dark);
        }
        
        /* Cart Sidebar */
        .cart-sidebar {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100vh;
            background: white;
            box-shadow: -4px 0 20px rgba(0,0,0,0.1);
            z-index: 2000;
            transition: right 0.3s ease;
            display: flex;
            flex-direction: column;
        }
        
        .cart-sidebar.open {
            right: 0;
        }
        
        .cart-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--gray-mid);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .cart-header h2 {
            font-size: 1.25rem;
            font-weight: 700;
        }
        
        .cart-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        .cart-items {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
        }
        
        .cart-item {
            display: flex;
            gap: 1rem;
            padding: 1rem 0;
            border-bottom: 1px solid var(--gray-light);
        }
        
        .cart-item-image {
            width: 80px;
            height: 60px;
            object-fit: cover;
        }
        
        .cart-item-info {
            flex: 1;
        }
        
        .cart-item-title {
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .cart-item-license {
            color: var(--gray-dark);
            font-size: 0.8rem;
        }
        
        .cart-item-price {
            font-weight: 700;
        }
        
        .cart-item-remove {
            background: none;
            border: none;
            color: var(--gray-dark);
            cursor: pointer;
            font-size: 1.25rem;
        }
        
        .cart-footer {
            padding: 1.5rem;
            border-top: 1px solid var(--gray-mid);
        }
        
        .cart-total {
            display: flex;
            justify-content: space-between;
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }
        
        .checkout-btn {
            width: 100%;
            padding: 1rem;
            background: var(--black);
            color: white;
            border: none;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            text-transform: uppercase;
        }
        
        .checkout-btn:disabled {
            background: var(--gray-mid);
            cursor: not-allowed;
        }
        
        .cart-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1999;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s;
        }
        
        .cart-overlay.open {
            opacity: 1;
            visibility: visible;
        }
        
        /* Lightbox - Clean white design */
        .lightbox {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #ffffff;
            z-index: 3000;
            display: none;
            flex-direction: row;
        }
        
        .lightbox.open {
            display: flex;
        }
        
        /* Hide thumbnail strip */
        .lb-thumb-strip {
            display: none;
        }
        
        .lb-thumb-nav {
            display: none;
        }
        
        .lb-thumb-scroll {
            display: none;
        }
        
        .lb-thumb {
            display: none;
        }
        
        /* Close button */
        .lb-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            color: var(--black);
            font-size: 2rem;
            cursor: pointer;
            z-index: 3010;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: opacity 0.2s;
        }
        
        .lb-close:hover {
            opacity: 0.6;
        }
        
        /* Main content area */
        .lb-body {
            flex: 1;
            display: flex;
            min-height: 0;
            width: 100%;
        }
        
        /* Hide left info panel - moved to right */
        .lb-info-panel {
            display: none;
        }
        
        /* Center image area - takes most space */
        .lb-image-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-width: 0;
            padding: 1.5rem;
            background: #f5f5f5;
        }
        
        .lb-image-wrapper {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 0;
            width: 100%;
        }
        
        .lb-image-container {
            position: relative;
            display: inline-block;
            max-width: 100%;
            max-height: calc(100vh - 120px);
        }
        
        .lb-main-image {
            display: block;
            max-width: 100%;
            max-height: calc(100vh - 120px);
            object-fit: contain;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }
        
        /* Lightbox watermark - Getty style, contained within image */
        .lb-watermark {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(90, 90, 90, 0.75);
            padding: 10px 14px;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        
        .lb-watermark .watermark-logo {
            font-family: Georgia, 'Times New Roman', serif;
            font-size: 1.1rem;
            font-weight: 400;
            font-style: italic;
            color: white;
            line-height: 1.1;
        }
        
        .lb-watermark .watermark-id {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            font-size: 0.65rem;
            font-weight: 500;
            color: rgba(255,255,255,0.9);
            margin-top: 3px;
        }
        
        .lb-bottom-nav {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1.5rem;
            padding: 1.25rem 0 0;
            flex-shrink: 0;
        }
        
        .lb-nav-arrow {
            background: none;
            border: 1px solid var(--gray-mid);
            color: var(--black);
            width: 44px;
            height: 44px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .lb-nav-arrow:hover {
            background: var(--black);
            border-color: var(--black);
            color: white;
        }
        
        .lb-nav-arrow svg {
            width: 20px;
            height: 20px;
        }
        
        .lb-counter {
            color: var(--gray-dark);
            font-size: 0.9rem;
            font-variant-numeric: tabular-nums;
            letter-spacing: 0.5px;
        }
        
        /* Right panel - combined info and purchase */
        .lb-purchase-panel {
            width: 340px;
            padding: 2rem 1.5rem;
            color: var(--black);
            overflow-y: auto;
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            background: white;
            border-left: 1px solid var(--gray-mid);
        }
        
        .lb-panel-section {
            padding-bottom: 1.25rem;
            border-bottom: 1px solid var(--gray-light);
        }
        
        .lb-panel-section:last-child {
            border-bottom: none;
            padding-bottom: 0;
        }
        
        .lb-image-id {
            font-size: 0.8rem;
            color: var(--gray-dark);
            letter-spacing: 0.5px;
            margin-bottom: 0.5rem;
        }
        
        .lb-info-label {
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--gray-dark);
            margin-bottom: 0.35rem;
        }
        
        .lb-info-value {
            font-size: 0.95rem;
            color: var(--black);
            line-height: 1.4;
        }
        
        .lb-info-value a {
            color: var(--black);
            text-decoration: underline;
            text-underline-offset: 2px;
        }
        
        .lb-info-value a:hover {
            opacity: 0.7;
        }
        
        .lb-license-label {
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--gray-dark);
            margin-bottom: 0.5rem;
        }
        
        .lb-license-select {
            width: 100%;
            padding: 0.85rem 1rem;
            background: white;
            border: 1px solid var(--gray-mid);
            color: var(--black);
            font-size: 0.95rem;
            font-family: inherit;
            cursor: pointer;
            appearance: none;
            -webkit-appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%23333' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
        }
        
        .lb-license-select:focus {
            outline: none;
            border-color: var(--black);
        }
        
        .lb-license-select option {
            background: white;
            color: var(--black);
        }
        
        .lb-price {
            font-size: 2.25rem;
            font-weight: 700;
            letter-spacing: -1px;
            margin: 0.25rem 0;
        }
        
        .lb-add-cart-btn {
            width: 100%;
            padding: 1rem;
            background: #00b341;
            color: white;
            border: none;
            font-size: 0.95rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .lb-add-cart-btn:hover {
            background: #009935;
        }
        
        .lb-add-cart-btn.added {
            background: white;
            border: 2px solid var(--gray-mid);
            color: var(--black);
            cursor: pointer;
            font-size: 0.85rem;
        }
        
        .lb-add-cart-btn.added:hover {
            border-color: var(--black);
        }
        
        .lb-license-description {
            font-size: 0.8rem;
            color: var(--gray-dark);
            line-height: 1.5;
            margin-top: 0.75rem;
        }
        
        .lb-license-description ul {
            margin: 0.5rem 0 0 0;
            padding-left: 1.1rem;
        }
        
        .lb-license-description li {
            margin-bottom: 0.25rem;
        }
        
        .lb-copyright {
            font-size: 0.75rem;
            color: var(--gray-dark);
            margin-top: auto;
            padding-top: 1rem;
        }
        
        /* Responsive lightbox */
        @media (max-width: 1024px) {
            .lb-purchase-panel { width: 320px; padding: 2rem 1.5rem; }
        }
        
        @media (max-width: 900px) {
            .lightbox.open {
                display: flex;
                flex-direction: column;
            }
            
            .lb-body {
                flex-direction: column;
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            .lb-image-area {
                order: 1;
                flex: none;
                padding: 1rem;
            }
            
            .lb-image-wrapper {
                flex: none;
                min-height: auto;
            }
            
            .lb-main-image {
                width: 100%;
                max-height: 60vh;
            }
            
            .lb-bottom-nav {
                padding: 1rem 0 0;
            }
            
            .lb-purchase-panel {
                order: 2;
                width: 100%;
                padding: 1.5rem;
                gap: 1rem;
                border-left: none;
                border-top: 1px solid var(--gray-mid);
            }
            
            .lb-close {
                top: 12px;
                right: 12px;
            }
        }
        
        @media (max-width: 600px) {
            .lb-close {
                top: 10px;
                right: 10px;
                font-size: 1.75rem;
                width: 40px;
                height: 40px;
            }
            
            .lb-image-area {
                padding: 0.75rem;
            }
            
            .lb-main-image {
                max-height: 50vh;
            }
            
            .lb-purchase-panel {
                padding: 1.25rem 1rem;
            }
            
            .lb-price {
                font-size: 1.75rem;
            }
            
            .lb-nav-arrow {
                width: 40px;
                height: 40px;
            }
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .project-title {
                font-size: 2rem;
            }
            
            .photos-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 6px;
            }
            
            .cart-sidebar {
                width: 100%;
                right: -100%;
            }
            
            /* Always show overlay on mobile (no hover) */
            .photo-hover-overlay {
                opacity: 1;
            }
            
            .photo-cart-btn {
                width: 32px;
                height: 32px;
                top: 6px;
                right: 6px;
            }
            
            .photo-cart-btn svg {
                width: 15px;
                height: 15px;
            }
            
            .photo-info-name {
                font-size: 0.7rem;
            }
            
            .photo-info-id {
                font-size: 0.6rem;
            }
        }
        
        /* Also always show on touch devices regardless of width */
        @media (hover: none) {
            .photo-hover-overlay {
                opacity: 1;
            }
        }
        
        /* Toast notification */
        .toast {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            background: var(--black);
            color: white;
            padding: 1rem 2rem;
            border-radius: 4px;
            font-weight: 600;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 4000;
        }
        
        .toast.show {
            opacity: 1;
        }
        
        /* Gallery Actions */
        .gallery-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
            margin-top: 1.5rem;
        }
        
        /* Set Tabs */
        .sets-row {
            display: flex;
            align-items: flex-end;
            justify-content: space-between;
            border-bottom: 1px solid var(--gray-mid);
            margin-bottom: 1.5rem;
        }
        
        .set-tabs {
            display: flex;
            gap: 0;
            border-bottom: none;
            margin-bottom: 0;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .set-tab {
            padding: 0.75rem 1.5rem;
            background: none;
            border: none;
            font-family: 'PP Neue York', Georgia, serif;
            font-size: 0.9rem;
            font-weight: 400;
            color: var(--gray-dark);
            cursor: pointer;
            white-space: nowrap;
            border-bottom: 2px solid transparent;
            margin-bottom: -1px;
            transition: color 0.2s, border-color 0.2s;
        }
        
        .set-tab:hover {
            color: var(--black);
        }
        
        .set-tab.active {
            color: var(--black);
            border-bottom-color: var(--black);
        }
        
        .set-tab-count {
            font-size: 0.75rem;
            color: var(--gray-dark);
            margin-left: 0.35rem;
        }
        
        .set-tab.active .set-tab-count {
            color: var(--black);
        }
        
        @media (max-width: 600px) {
            .set-tab {
                padding: 0.6rem 1rem;
                font-size: 0.85rem;
            }
        }
        
        .add-all-btn {
            padding: 0.75rem 1.5rem;
            background: var(--black);
            color: white;
            border: none;
            font-size: 0.85rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            cursor: pointer;
        }
        
        .add-all-btn:hover { background: #333; }
        
        /* Download Code Bar - Pixieset style */
        .download-code-bar {
            background: var(--gray-light);
            border: 2px solid var(--gray-mid);
            border-radius: 6px;
            padding: 1rem 1.5rem;
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            flex-wrap: wrap;
        }
        
        .download-code-bar .code-icon {
            font-size: 1.25rem;
        }
        
        .download-code-bar label {
            font-weight: 600;
            font-size: 0.9rem;
            white-space: nowrap;
        }
        
        .download-code-bar input {
            padding: 0.5rem 0.75rem;
            border: 2px solid var(--gray-mid);
            border-radius: 4px;
            font-size: 0.9rem;
            font-family: inherit;
            font-weight: 600;
            text-transform: uppercase;
            width: 160px;
            background: white;
        }
        
        .download-code-bar input:focus {
            outline: none;
            border-color: var(--black);
        }
        
        .download-code-bar input::placeholder {
            font-weight: 400;
            text-transform: none;
            color: #999;
        }
        
        .code-apply-btn {
            padding: 0.5rem 1.25rem;
            background: var(--black);
            color: white;
            border: none;
            font-size: 0.85rem;
            font-weight: 700;
            cursor: pointer;
            border-radius: 4px;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }
        
        .code-apply-btn:hover { background: #333; }
        
        .code-status {
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .code-status.valid { color: #10b981; }
        .code-status.invalid { color: #ef4444; }
        
        /* Download mode active - green accent bar */
        .download-active-bar {
            background: #ecfdf5;
            border-color: #10b981;
            padding: 1rem 1.5rem;
            margin-bottom: 2rem;
            border-radius: 6px;
            border: 2px solid #10b981;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .download-active-bar .status-text {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
            font-size: 0.9rem;
            color: #065f46;
        }
        
        .download-all-btn {
            padding: 0.65rem 1.5rem;
            background: #10b981;
            color: white;
            border: none;
            font-size: 0.85rem;
            font-weight: 700;
            cursor: pointer;
            border-radius: 4px;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .download-all-btn:hover { background: #059669; }
        
        /* Photo download overlay icon */
        .photo-download-btn {
            position: absolute;
            bottom: 8px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 0.5rem;
            z-index: 5;
            pointer-events: auto;
            opacity: 0;
            transition: opacity 0.25s;
        }
        
        .photo-card:hover .photo-download-btn {
            opacity: 1;
        }
        
        .photo-dl-icon, .photo-fav-icon, .photo-share-icon {
            width: 36px;
            height: 36px;
            background: rgba(0,0,0,0.7);
            border: none;
            border-radius: 4px;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(4px);
        }
        
        .photo-dl-icon:hover, .photo-fav-icon:hover, .photo-share-icon:hover {
            background: rgba(0,0,0,0.9);
        }
        
        .photo-dl-icon svg, .photo-fav-icon svg, .photo-share-icon svg {
            width: 18px;
            height: 18px;
            stroke: white;
            fill: none;
        }
        
        /* ===== CLEAN LIGHTBOX (cart disabled) ===== */
        .lightbox.clean-mode .lb-thumb-strip { display: none; }
        .lightbox.clean-mode .lb-info-panel { display: none; }
        .lightbox.clean-mode .lb-purchase-panel { display: none; }
        .lightbox.clean-mode .lb-bottom-nav { display: none; }
        
        .lightbox.clean-mode .lb-close {
            top: 16px;
            right: 16px;
            width: 48px;
            height: 48px;
            font-size: 2.25rem;
            color: rgba(255,255,255,0.75);
            z-index: 3020;
        }
        .lightbox.clean-mode .lb-close:hover { color: white; }
        
        .lightbox.clean-mode .lb-image-area {
            padding: 0;
            position: relative;
        }
        
        .lightbox.clean-mode .lb-image-wrapper {
            padding: 0;
            align-items: center;
            justify-content: center;
        }
        
        .lightbox.clean-mode .lb-main-image {
            max-width: calc(100% - 120px);
            max-height: calc(100vh - 40px);
            object-fit: contain;
        }
        
        /* Side arrows for clean mode */
        .clean-nav-arrow {
            display: none;
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: rgba(255,255,255,0.55);
            width: 52px;
            height: 52px;
            cursor: pointer;
            z-index: 3015;
            transition: color 0.2s;
            align-items: center;
            justify-content: center;
        }
        .clean-nav-arrow:hover { color: white; }
        .clean-nav-arrow svg {
            width: 32px;
            height: 32px;
        }
        .clean-nav-prev { left: 16px; }
        .clean-nav-next { right: 16px; }
        
        .lightbox.clean-mode .clean-nav-arrow {
            display: flex;
        }
        
        /* Clean mode counter */
        .clean-counter {
            display: none;
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(255,255,255,0.45);
            font-size: 0.85rem;
            font-variant-numeric: tabular-nums;
            letter-spacing: 1px;
            z-index: 3015;
        }
        .lightbox.clean-mode .clean-counter {
            display: block;
        }
        
        /* Hide cart elements when cart is disabled */
        .cart-hidden { display: none !important; }
        
        @media (max-width: 900px) {
            .lightbox.clean-mode .lb-main-image {
                max-width: calc(100% - 20px);
                max-height: calc(100vh - 80px);
            }
            .lightbox.clean-mode .lb-close {
                top: 12px;
                right: 12px;
                width: 40px;
                height: 40px;
                font-size: 1.75rem;
            }
            .clean-nav-arrow { width: 40px; height: 40px; }
            .clean-nav-arrow svg { width: 24px; height: 24px; }
            .clean-nav-prev { left: 4px; }
            .clean-nav-next { right: 4px; }
        }
        
        /* Lightbox download button */
        .lb-download-btn {
            padding: 0.75rem 1.5rem;
            background: #10b981;
            color: white;
            border: none;
            font-size: 0.85rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            cursor: pointer;
            border-radius: 4px;
            margin-top: 0.5rem;
            display: none;
        }
        
        .lb-download-btn:hover { background: #059669; }
        
        /* Download modal - Pixieset style */
        .dl-modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            z-index: 10000;
            display: none;
            align-items: center;
            justify-content: center;
        }
        
        .dl-modal-overlay.open {
            display: flex;
        }
        
        .dl-modal {
            background: white;
            border-radius: 8px;
            padding: 2.5rem;
            width: 100%;
            max-width: 420px;
            margin: 1rem;
        }
        
        .dl-modal h2 {
            font-size: 1.4rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 1.75rem;
        }
        
        .dl-modal-section-label {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: var(--gray-dark);
            margin-bottom: 0.75rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--gray-mid);
        }
        
        .dl-option {
            padding: 1rem 1.25rem;
            border: 2px solid var(--gray-mid);
            border-radius: 4px;
            margin-bottom: 0.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 0.95rem;
            font-weight: 500;
        }
        
        .dl-option:hover { border-color: var(--black); }
        
        .dl-option.selected {
            border-color: var(--black);
        }
        
        .dl-option .check {
            width: 20px;
            height: 20px;
            border: 2px solid var(--gray-mid);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .dl-option.selected .check {
            border-color: var(--black);
            background: var(--black);
            color: white;
            font-size: 0.75rem;
        }
        
        .dl-modal-download-btn {
            width: 100%;
            padding: 1rem;
            background: #333;
            color: white;
            border: none;
            font-size: 0.95rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            border-radius: 4px;
            margin-top: 1.5rem;
        }
        
        .dl-modal-download-btn:hover { background: var(--black); }
        
        /* Email collection modal */
        .email-modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            z-index: 10001;
            display: none;
            align-items: center;
            justify-content: center;
        }
        
        .email-modal-overlay.open {
            display: flex;
        }
        
        .email-modal {
            background: white;
            border-radius: 8px;
            padding: 2.5rem;
            width: 100%;
            max-width: 420px;
            margin: 1rem;
            position: relative;
        }
        
        .email-modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            width: 32px;
            height: 32px;
            border: none;
            background: transparent;
            font-size: 1.75rem;
            color: var(--gray-dark);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
            padding: 0;
            transition: color 0.2s;
        }
        
        .email-modal-close:hover {
            color: var(--black);
        }
        
        .email-modal h2 {
            font-size: 1.4rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 1rem;
        }
        
        .email-modal p {
            color: var(--gray-dark);
            font-size: 0.95rem;
            margin-bottom: 1.5rem;
            line-height: 1.5;
        }
        
        .email-modal input {
            width: 100%;
            padding: 0.9rem 1rem;
            border: 1px solid var(--gray-mid);
            border-radius: 4px;
            font-size: 1rem;
            font-family: inherit;
            margin-bottom: 1rem;
        }
        
        .email-modal input:focus {
            outline: none;
            border-color: var(--black);
        }
        
        .email-modal-btn {
            width: 100%;
            padding: 1rem;
            background: #333;
            color: white;
            border: none;
            font-size: 0.95rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            border-radius: 4px;
        }
        
        .email-modal-btn:hover { background: var(--black); }
        .email-modal-btn:disabled { background: var(--gray-dark); cursor: not-allowed; }
        
        .email-modal-error {
            color: #e53935;
            font-size: 0.85rem;
            margin-top: -0.5rem;
            margin-bottom: 1rem;
            display: none;
        }
        
        .email-modal-error.show {
            display: block;
        }
        
        /* Code fallback in email modal */
        .email-code-fallback {
            display: none;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--gray-mid);
        }
        
        .email-code-fallback.show {
            display: block;
        }
        
        .fallback-divider {
            text-align: center;
            color: var(--gray-dark);
            font-size: 0.85rem;
            margin-bottom: 1rem;
        }
        
        .fallback-input-row {
            display: flex;
            gap: 0.5rem;
        }
        
        .fallback-input-row input {
            flex: 1;
            margin-bottom: 0;
        }
        
        .fallback-code-btn {
            padding: 0.9rem 1.25rem;
            background: var(--black);
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            white-space: nowrap;
        }
        
        .fallback-code-btn:hover {
            background: #333;
        }
        
        .fallback-code-status {
            font-size: 0.85rem;
            margin-top: 0.5rem;
            color: #ef4444;
        }
        
        @media (max-width: 768px) {
            .gallery-actions {
                flex-direction: column;
                align-items: stretch;
            }
            .add-all-btn { text-align: center; }
            .download-all-btn { justify-content: center; width: 100%; }
            .photo-actions { opacity: 1; }
        }
    </style>
</head>
<body>
    <!-- ── Header ── -->
    <header class="header">
        <div class="header-inner">
            <div class="header-left">
                <button class="hamburger" onclick="openMobileMenu()" aria-label="Open menu">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16"/>
                    </svg>
                </button>
                <a href="/" class="logo">SF EVENT PHOTO</a>
            </div>
            <nav class="nav">
                <div class="nav-links">
                    <a href="/about.html">About</a>
                    <a href="/services.html">Services</a>
                    <a href="/contact.html">Contact</a>
                </div>
                <div class="nav-actions">
                    <a href="/signin.html" class="auth-link" id="signInLink">Sign In</a>
                    <div class="user-menu" id="userMenu" style="display: none;">
                        <button class="user-menu-btn" onclick="toggleUserMenu()">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                                <circle cx="12" cy="7" r="4"/>
                            </svg>
                            <span id="userName">Account</span>
                        </button>
                        <div class="user-dropdown" id="userDropdown">
                            <a href="/my-photos.html">My Photos</a>
                            <button class="signout-btn" onclick="signOut()">
                                Sign Out
                                <div class="user-email" id="userEmail"></div>
                            </button>
                        </div>
                    </div>
                    <a href="#" class="cart-link" onclick="toggleCart(); return false;">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
                        </svg>
                        <span class="cart-badge" id="cartCount">0</span>
                    </a>
                </div>
            </nav>
        </div>
    </header>

    <!-- Mobile Menu -->
    <div class="mobile-menu" id="mobileMenu">
        <div class="mobile-menu-header">
            <a href="/" class="logo">SF EVENT PHOTO</a>
            <button class="mobile-menu-close" onclick="closeMobileMenu()" aria-label="Close menu">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
        </div>
        <nav class="mobile-menu-links">
            <a href="/">Home</a>
            <a href="/about.html">About</a>
            <a href="/services.html">Services</a>
            <a href="/contact.html">Contact</a>
        </nav>
    </div>

    <main class="main">
        <a href="/" class="back-link">← Back to Projects</a>
        
        <div id="projectContainer">
            <div class="loading">
                <div class="loading-spinner"></div>
                <p>Loading project...</p>
            </div>
        </div>
    </main>

    <!-- ── Footer ── -->
    <footer class="footer">
        <div class="footer-inner">
            <div class="footer-left">
                <span>© 2026 SF Event Photo</span>
                <a href="/privacy.html">Privacy Policy</a>
            </div>
            <div class="footer-right">
                <a href="mailto:bookings@sfeventphoto.com">Email</a>
                <a href="https://instagram.com/sfeventphoto" target="_blank">Instagram</a>
                <a href="https://linkedin.com/company/sfeventphoto" target="_blank">LinkedIn</a>
            </div>
        </div>
    </footer>

    <!-- Cart Sidebar -->
    <div class="cart-overlay" id="cartOverlay" onclick="toggleCart()"></div>
    <div class="cart-sidebar" id="cartSidebar">
        <div class="cart-header">
            <h2>Your Cart</h2>
            <button class="cart-close" onclick="toggleCart()">&times;</button>
        </div>
        <div class="cart-items" id="cartItems">
            <div class="empty-state"><p>Your cart is empty</p></div>
        </div>
        <div class="cart-footer">
            <div class="cart-total">
                <span>Total</span>
                <span id="cartTotal">$0.00</span>
            </div>
            <button class="checkout-btn" id="checkoutBtn" onclick="checkout()" disabled>
                Proceed to Checkout
            </button>
        </div>
    </div>

    <!-- Lightbox - BFA style -->
    <div class="lightbox" id="lightbox">
        <!-- Thumbnail strip -->
        <div class="lb-thumb-strip">
            <button class="lb-thumb-nav" onclick="lbPrev()">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>
            </button>
            <div class="lb-thumb-scroll" id="lbThumbScroll"></div>
            <button class="lb-thumb-nav" onclick="lbNext()">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
            </button>
        </div>
        
        <button class="lb-close" onclick="closeLightbox()">&times;</button>
        
        <!-- Clean mode side arrows -->
        <button class="clean-nav-arrow clean-nav-prev" onclick="lbPrev()">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 19l-7-7 7-7"/></svg>
        </button>
        <button class="clean-nav-arrow clean-nav-next" onclick="lbNext()">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 5l7 7-7 7"/></svg>
        </button>
        <div class="clean-counter" id="cleanCounter"></div>
        
        <!-- Main body: info | image | purchase -->
        <div class="lb-body">
            <!-- Center image -->
            <div class="lb-image-area">
                <div class="lb-image-wrapper">
                    <div class="lb-image-container">
                        <img src="" alt="" class="lb-main-image" id="lbMainImage">
                        <!-- Lightbox watermark -->
                        <div class="lb-watermark">
                            <div class="watermark-logo">SF Event Photo</div>
                            <div class="watermark-id" id="lbWatermarkId"></div>
                        </div>
                    </div>
                </div>
                <div class="lb-bottom-nav">
                    <button class="lb-nav-arrow prev" onclick="lbPrev()">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>
                    </button>
                    <div class="lb-counter" id="lbCounter"></div>
                    <button class="lb-nav-arrow next" onclick="lbNext()">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
                    </button>
                </div>
            </div>
            
            <!-- Right panel - info and purchase combined -->
            <div class="lb-purchase-panel">
                <div class="lb-panel-section">
                    <div class="lb-image-id" id="lbImageId"></div>
                    <div class="lb-info-group">
                        <div class="lb-info-label">Gallery</div>
                        <div class="lb-info-value" id="lbGalleryTitle"></div>
                    </div>
                    <div class="lb-info-group" id="lbDateGroup" style="display:none;margin-top:0.75rem;">
                        <div class="lb-info-label">Date</div>
                        <div class="lb-info-value" id="lbDate"></div>
                    </div>
                    <div class="lb-info-group" id="lbPeopleGroup" style="display:none;margin-top:0.75rem;">
                        <div class="lb-info-label">People</div>
                        <div class="lb-info-value" id="lbPeople"></div>
                    </div>
                </div>
                
                <div class="lb-panel-section">
                    <div class="lb-license-label">License</div>
                    <select class="lb-license-select" id="lbLicenseSelect" onchange="lbUpdatePrice()">
                        <option value="web_editorial">Web Editorial (Single Use)</option>
                        <option value="pr_usage">PR / Commercial Usage</option>
                    </select>
                    <div class="lb-price" id="lbPrice">$85.00</div>
                    <button class="lb-add-cart-btn" id="lbAddCartBtn" onclick="lbAddToCart()">
                        ADD TO CART
                    </button>
                    <div class="lb-license-description" id="lbLicenseDesc">
                        <strong>Includes:</strong>
                        <ul>
                            <li>High-resolution digital file</li>
                            <li>Single use on website or social media</li>
                            <li>No expiration date</li>
                        </ul>
                    </div>
                </div>
                
                <div class="lb-panel-section">
                    <button class="lb-download-btn" id="lbDownloadBtn" onclick="downloadSinglePhoto(lbCurrentIndex)">
                        ↓ DOWNLOAD
                    </button>
                </div>
                
                <div class="lb-copyright">&copy; SF Event Photo 2026. All rights reserved.</div>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <script>
        const API_URL = 'https://sf-event-photo-backend.vercel.app';
        
        // Default license prices (will be overridden by site settings)
        let LICENSE_PRICES = {
            'web_editorial': { id: 'web_editorial', name: 'Web Editorial (Single Use)', price: 8500, description: 'High-resolution digital file\nSingle use on website or social media\nNo expiration date' },
            'pr_usage': { id: 'pr_usage', name: 'PR / Commercial Usage', price: 25000, description: 'High-resolution digital file\nUnlimited digital & print usage\nPR, advertising, and commercial use\nNo expiration date' }
        };
        
        // Will be populated from site settings
        let allLicenses = [];
        let projectLicenses = []; // Licenses enabled for this specific project
        
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        let currentProject = null;
        let currentSetIndex = 0;
        let projectSets = [];
        let cartEnabled = true; // Will be set from project data
        
        // Get slug from URL
        const urlParams = new URLSearchParams(window.location.search);
        const slug = urlParams.get('slug');
        
        // Load site settings (licenses)
        async function loadSiteSettings() {
            try {
                const r = await fetch(`${API_URL}/api/site-settings`);
                const data = await r.json();
                if (data.settings && data.settings.licenses && data.settings.licenses.length > 0) {
                    allLicenses = data.settings.licenses;
                    // Convert to LICENSE_PRICES format
                    LICENSE_PRICES = {};
                    allLicenses.forEach(lic => {
                        LICENSE_PRICES[lic.id] = lic;
                    });
                }
            } catch (e) {
                console.log('Using default licenses');
            }
        }
        
        document.addEventListener('DOMContentLoaded', async () => {
            if (!slug) {
                window.location.href = '/';
                return;
            }
            checkAuth();
            await loadSiteSettings();
            loadProject();
            updateCartUI();
        });
        
        function getProjectSets(project) {
            if (!project.photos || project.photos.length === 0) return [];
            
            // Group photos by set_name
            const setMap = new Map();
            project.photos.forEach(photo => {
                const setName = photo.set_name || 'All Photos';
                if (!setMap.has(setName)) {
                    setMap.set(setName, []);
                }
                setMap.get(setName).push(photo);
            });
            
            // Convert to array and sort by set_order if available
            const sets = Array.from(setMap.entries()).map(([name, photos]) => ({
                name,
                photos,
                order: photos[0]?.set_order || 0
            }));
            sets.sort((a, b) => a.order - b.order);
            
            return sets;
        }
        
        function renderSetTabs() {
            if (projectSets.length <= 1) return '';
            
            return `
                <div class="set-tabs" id="setTabs">
                    ${projectSets.map((set, idx) => `
                        <button class="set-tab ${idx === currentSetIndex ? 'active' : ''}" onclick="switchSet(${idx})">
                            ${set.name}<span class="set-tab-count">(${set.photos.length})</span>
                        </button>
                    `).join('')}
                </div>
            `;
        }
        
        function switchSet(index) {
            currentSetIndex = index;
            
            // Update tab active state
            document.querySelectorAll('.set-tab').forEach((tab, i) => {
                tab.classList.toggle('active', i === index);
            });
            
            // Re-render photos grid
            renderPhotosGrid();
        }
        
        function getCurrentPhotos() {
            if (projectSets.length === 0) return currentProject?.photos || [];
            return projectSets[currentSetIndex]?.photos || [];
        }
        
        function getVimeoThumb(vimeoId) {
            return `https://vumbnail.com/${vimeoId}.jpg`;
        }
        
        function renderVideoCards() {
            const videos = currentProject?.videos || [];
            if (videos.length === 0) return '';
            
            return videos.map((video, index) => `
                <div class="video-card" onclick="openVideoModal('${video.vimeo_id}')">
                    <img 
                        src="${getVimeoThumb(video.vimeo_id)}" 
                        alt="Event video"
                        class="video-thumb"
                        loading="eager"
                    >
                    <div class="video-play-btn">
                        <svg viewBox="0 0 24 24"><polygon points="5,3 19,12 5,21"/></svg>
                    </div>
                    <div class="video-badge">Video</div>
                </div>
            `).join('');
        }
        
        function openVideoModal(vimeoId) {
            const modal = document.getElementById('videoModal');
            const iframe = document.getElementById('videoIframe');
            iframe.src = `https://player.vimeo.com/video/${vimeoId}?autoplay=1&title=0&byline=0&portrait=0`;
            modal.classList.add('open');
            document.body.style.overflow = 'hidden';
        }
        
        function closeVideoModal(event) {
            if (event && event.target !== event.currentTarget) return;
            const modal = document.getElementById('videoModal');
            const iframe = document.getElementById('videoIframe');
            iframe.src = '';
            modal.classList.remove('open');
            document.body.style.overflow = '';
        }
        
        // Close video modal on Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                const modal = document.getElementById('videoModal');
                if (modal.classList.contains('open')) {
                    closeVideoModal();
                }
            }
        });
        
        function renderPhotosGrid() {
            const photos = getCurrentPhotos();
            const grid = document.getElementById('photosGrid');
            if (!grid) return;
            
            const videoCards = renderVideoCards();
            const hasVideos = (currentProject?.videos || []).length > 0;
            
            if (photos.length === 0 && !hasVideos) {
                grid.innerHTML = '<div class="empty-state"><p>No photos in this set</p></div>';
                return;
            }
            
            const photoCards = photos.map((photo, index) => `
                <div class="photo-card" id="card-${index}" onclick="openLightbox(${index})">
                    <img 
                        src="${photo.thumbnail_url || photo.large_url}" 
                        alt="Event photo"
                        class="photo-image"
                        loading="${index < 8 ? 'eager' : 'lazy'}"
                        decoding="async"
                        ${index < 4 ? 'fetchpriority="high"' : ''}
                    >
                    <!-- Action buttons - bottom right -->
                    <div class="photo-actions">
                        ${cartEnabled ? `<button class="photo-action-btn" onclick="event.stopPropagation(); openLightbox(${index})" title="Add to cart">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 0 1-8 0"/>
                            </svg>
                        </button>` : ''}
                        <button class="photo-action-btn" onclick="event.stopPropagation(); downloadSinglePhoto(${index})" title="Download">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/>
                            </svg>
                        </button>
                    </div>
                    <!-- Info overlay - names above ID -->
                    <div class="photo-info-overlay">
                        ${photo.people && photo.people.length > 0 ? `<div class="photo-info-name">${photo.people.join(', ')}</div>` : ''}
                        <div class="photo-info-id">${photo.photo_number || photo.filename?.replace(/\.[^.]+$/, '') || ''}</div>
                    </div>
                </div>
            `).join('');
            
            // Videos appear first, then photos
            grid.innerHTML = videoCards + photoCards;
        }
        
        async function loadProject() {
            const container = document.getElementById('projectContainer');
            
            try {
                const response = await fetch(`${API_URL}/api/projects/${slug}`);
                const project = await response.json();
                
                if (project.error) throw new Error(project.error);
                
                // Check if project is private and requires password
                if (project.is_private) {
                    const storedAccess = sessionStorage.getItem(`gallery_access_${slug}`);
                    if (storedAccess !== 'granted') {
                        showPasswordPrompt(project);
                        return;
                    }
                }
                
                renderProject(project);
                
            } catch (error) {
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>Project not found</h3>
                        <p>This gallery may not exist or is unavailable.</p>
                        <a href="/" class="back-link" style="margin-top: 1rem;">← Back to Projects</a>
                    </div>
                `;
            }
        }
        
        function showPasswordPrompt(project) {
            const container = document.getElementById('projectContainer');
            container.innerHTML = `
                <div class="password-prompt">
                    <div class="password-prompt-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 10.5V6.75a4.5 4.5 0 10-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 002.25-2.25v-6.75a2.25 2.25 0 00-2.25-2.25H6.75a2.25 2.25 0 00-2.25 2.25v6.75a2.25 2.25 0 002.25 2.25z"/>
                        </svg>
                    </div>
                    <h2 class="password-prompt-title">${project.title}</h2>
                    <p class="password-prompt-subtitle">This gallery is password protected</p>
                    <form onsubmit="checkPassword(event)" class="password-form">
                        <input type="password" id="galleryPassword" placeholder="Enter password" class="password-input" autofocus>
                        <button type="submit" class="password-submit">View Gallery</button>
                    </form>
                    <div id="passwordError" class="password-error"></div>
                </div>
            `;
        }
        
        async function checkPassword(event) {
            event.preventDefault();
            const input = document.getElementById('galleryPassword');
            const error = document.getElementById('passwordError');
            const submitBtn = document.querySelector('.password-submit');
            
            submitBtn.disabled = true;
            submitBtn.textContent = 'Checking...';
            
            try {
                const response = await fetch(`${API_URL}/api/projects/${slug}/verify-password`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ password: input.value })
                });
                const result = await response.json();
                
                if (result.success) {
                    sessionStorage.setItem(`gallery_access_${slug}`, 'granted');
                    loadProject();
                } else {
                    error.textContent = 'Incorrect password';
                    input.classList.add('error');
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'View Gallery';
                    setTimeout(() => {
                        error.textContent = '';
                        input.classList.remove('error');
                    }, 3000);
                }
            } catch (e) {
                error.textContent = 'Error checking password';
                submitBtn.disabled = false;
                submitBtn.textContent = 'View Gallery';
            }
        }
        
        function renderProject(project) {
            const container = document.getElementById('projectContainer');
            
            currentProject = project;
            projectSets = getProjectSets(project);
            currentSetIndex = 0;
            document.title = `${project.title} - SF Event Photo`;
            
            // Check if cart is enabled for this project
            cartEnabled = project.cart_enabled !== false;
            
            // Hide cart UI elements if cart is disabled
            if (!cartEnabled) {
                document.querySelectorAll('.cart-link, .cart-badge').forEach(el => el.classList.add('cart-hidden'));
                document.getElementById('cartSidebar')?.classList.add('cart-hidden');
                document.getElementById('cartOverlay')?.classList.add('cart-hidden');
            }
            
            // Update SEO meta tags dynamically
            updateSEO(project);
            
            container.innerHTML = `
                <div class="project-header">
                    <div class="project-header-top">
                        <div class="project-header-left">
                            <h1 class="project-title">${project.title}</h1>
                            <div class="project-date">${project.event_date ? formatDateRange(project.event_date, project.event_end_date) : ''}</div>
                            <span class="project-meta-sep">&middot;</span>
                            <div class="project-venue">${project.venue || ''}</div>
                            <div class="project-credits">
                                <span>© SF Event Photo</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="sets-row">
                    ${renderSetTabs()}
                    <a href="#" class="download-gallery-link" onclick="downloadAllPhotos(); return false;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/>
                        </svg>
                        Download Gallery
                    </a>
                </div>
                
                ${project.photos && project.photos.length > 0 ? `
                    <div class="photos-grid" id="photosGrid"></div>
                ` : `
                    <div class="empty-state">
                        <h3>No photos yet</h3>
                        <p>Check back soon for photos from this event!</p>
                    </div>
                `}
                
                <!-- Download modal (Pixieset-style) -->
                <div class="dl-modal-overlay" id="dlModal">
                    <div class="dl-modal">
                        <h2>Download Photo</h2>
                        <div class="dl-modal-section-label">Photo Size</div>
                        <div class="dl-option selected" id="dlOptHigh" onclick="selectDlOption('high')">
                            <div class="check">✓</div>
                            <span>High Resolution</span>
                        </div>
                        <div class="dl-option" id="dlOptWeb" onclick="selectDlOption('web')">
                            <div class="check"></div>
                            <span>Web Size</span>
                        </div>
                        <button class="dl-modal-download-btn" onclick="confirmDownload()">Download Photo</button>
                        <button style="width:100%;padding:0.75rem;background:transparent;border:1px solid var(--gray-mid);border-radius:4px;cursor:pointer;margin-top:0.5rem;font-weight:600;font-size:0.9rem;" onclick="closeDlModal()">Cancel</button>
                        </div>
                    </div>
                    
                    <!-- Email collection modal -->
                    <div class="email-modal-overlay" id="emailModal" onclick="if(event.target===this)closeEmailModal()">
                        <div class="email-modal">
                            <button class="email-modal-close" onclick="closeEmailModal()" title="Close">×</button>
                            <h2>Download Photo</h2>
                            <p>Please enter your email to download.</p>
                            <input type="email" id="downloadEmail" placeholder="you@company.com" autocomplete="email">
                            <div class="email-modal-error" id="emailError">Please enter a valid email address</div>
                            <button class="email-modal-btn" id="emailSubmitBtn" onclick="submitDownloadEmail()">Continue</button>
                            
                            <!-- Code fallback - shown when email not approved -->
                            <div class="email-code-fallback" id="emailCodeFallback">
                                <div class="fallback-divider">or enter client code</div>
                                <div class="fallback-input-row">
                                    <input type="text" id="fallbackCodeInput" placeholder="Client code" maxlength="20">
                                    <button class="fallback-code-btn" onclick="submitFallbackCode()">Submit</button>
                                </div>
                                <div class="fallback-code-status" id="fallbackCodeStatus"></div>
                            </div>
                        </div>
                    </div>
                `;
                
                // Render initial photos
                if (project.photos && project.photos.length > 0) {
                    renderPhotosGrid();
                }
        }
        
        let lbCurrentIndex = 0;
        
        function openLightbox(photoIndex) {
            const photos = getCurrentPhotos();
            if (!photos || photos.length === 0) return;
            lbCurrentIndex = typeof photoIndex === 'number' ? photoIndex : 0;
            
            const lightbox = document.getElementById('lightbox');
            
            // Toggle clean mode based on cart_enabled
            if (!cartEnabled) {
                lightbox.classList.add('clean-mode');
            } else {
                lightbox.classList.remove('clean-mode');
            }
            
            // Build license dropdown based on project's enabled licenses
            const licenseSelect = document.getElementById('lbLicenseSelect');
            const enabledLicenseIds = currentProject.enabled_licenses || Object.keys(LICENSE_PRICES);
            const availableLicenses = enabledLicenseIds
                .map(id => LICENSE_PRICES[id])
                .filter(lic => lic); // Filter out undefined
            
            if (availableLicenses.length > 0) {
                licenseSelect.innerHTML = availableLicenses.map(lic => 
                    `<option value="${lic.id}">${lic.name}</option>`
                ).join('');
            }
            
            // Build thumbnails (only used in cart mode but build anyway)
            const thumbScroll = document.getElementById('lbThumbScroll');
            thumbScroll.innerHTML = photos.map((photo, i) => `
                <img 
                    src="${photo.thumbnail_url || photo.large_url}" 
                    alt="" 
                    class="lb-thumb ${i === lbCurrentIndex ? 'active' : ''}"
                    onclick="lbGoTo(${i})"
                    data-index="${i}"
                >
            `).join('');
            
            lbShowPhoto(lbCurrentIndex);
            lightbox.classList.add('open');
            document.body.style.overflow = 'hidden';
        }
        
        function closeLightbox() {
            document.getElementById('lightbox').classList.remove('open');
            document.body.style.overflow = '';
        }
        
        function lbGoTo(index) {
            const photos = getCurrentPhotos();
            if (!photos || photos.length === 0) return;
            lbCurrentIndex = index;
            lbShowPhoto(index);
        }
        
        function lbPrev() {
            const photos = getCurrentPhotos();
            if (!photos || photos.length === 0) return;
            lbCurrentIndex = (lbCurrentIndex - 1 + photos.length) % photos.length;
            lbShowPhoto(lbCurrentIndex);
        }
        
        function lbNext() {
            const photos = getCurrentPhotos();
            if (!photos || photos.length === 0) return;
            lbCurrentIndex = (lbCurrentIndex + 1) % photos.length;
            lbShowPhoto(lbCurrentIndex);
        }
        
        function lbShowPhoto(index) {
            const photos = getCurrentPhotos();
            const photo = photos[index];
            if (!photo) return;
            
            // Main image
            document.getElementById('lbMainImage').src = photo.large_url || photo.original_url || photo.thumbnail_url;
            
            // Counter
            document.getElementById('lbCounter').textContent = `${index + 1} of ${photos.length}`;
            
            // Clean mode counter
            const cleanCounter = document.getElementById('cleanCounter');
            if (cleanCounter) cleanCounter.textContent = `${index + 1} / ${photos.length}`;
            
            // Image ID
            document.getElementById('lbImageId').textContent = `Image ID: ${photo.photo_number || photo.filename?.replace(/\.[^.]+$/, '') || '—'}`;
            
            // Watermark ID
            const lbWatermarkId = document.getElementById('lbWatermarkId');
            if (lbWatermarkId) lbWatermarkId.textContent = photo.photo_number || '';
            
            // Gallery info
            document.getElementById('lbGalleryTitle').textContent = currentProject.title || '';
            
            // People (if available)
            const peopleGroup = document.getElementById('lbPeopleGroup');
            if (peopleGroup) {
                if (photo.people && photo.people.length > 0) {
                    const peopleEl = document.getElementById('lbPeople');
                    if (peopleEl) peopleEl.textContent = photo.people.join(', ');
                    peopleGroup.style.display = '';
                } else {
                    peopleGroup.style.display = 'none';
                }
            }
            
            // Date
            const dateGroup = document.getElementById('lbDateGroup');
            if (dateGroup) {
                if (currentProject.event_date) {
                    const dateEl = document.getElementById('lbDate');
                    if (dateEl) dateEl.textContent = formatDate(currentProject.event_date);
                    dateGroup.style.display = '';
                } else {
                    dateGroup.style.display = 'none';
                }
            }
            
            // Update thumbnails active state
            document.querySelectorAll('.lb-thumb').forEach((thumb, i) => {
                thumb.classList.toggle('active', i === index);
            });
            
            // Scroll active thumbnail into view
            const activeThumb = document.querySelector(`.lb-thumb[data-index="${index}"]`);
            if (activeThumb) {
                activeThumb.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
            }
            
            // Reset license select and price
            document.getElementById('lbLicenseSelect').value = 'web_editorial';
            lbUpdatePrice();
            
            // Reset add to cart button
            const btn = document.getElementById('lbAddCartBtn');
            btn.textContent = 'ADD TO CART';
            btn.classList.remove('added');
            btn.disabled = false;
            
            // Show/hide download button in lightbox
            const dlBtn = document.getElementById('lbDownloadBtn');
            if (dlBtn) dlBtn.style.display = activeDownloadCode ? 'block' : 'none';
        }
        
        function lbUpdatePrice() {
            const photos = getCurrentPhotos();
            const licenseType = document.getElementById('lbLicenseSelect').value;
            const license = LICENSE_PRICES[licenseType];
            if (!license) return;
            
            document.getElementById('lbPrice').textContent = `$${(license.price / 100).toFixed(2)}`;
            
            // Update license description from dynamic license data
            const descEl = document.getElementById('lbLicenseDesc');
            if (descEl && license.description) {
                const descItems = license.description.split('\n').filter(s => s.trim());
                descEl.innerHTML = `<strong>Includes:</strong>
                    <ul>
                        ${descItems.map(item => `<li>${item}</li>`).join('')}
                    </ul>`;
            }
            
            // Check if already in cart
            const photo = photos[lbCurrentIndex];
            if (!photo) return;
            const btn = document.getElementById('lbAddCartBtn');
            const existing = cart.find(item => item.photo_id === photo.id && item.license_type === licenseType);
            if (existing) {
                btn.textContent = 'ADDED TO CART – VIEW CART';
                btn.classList.add('added');
            } else {
                btn.textContent = 'ADD TO CART';
                btn.classList.remove('added');
            }
        }
        
        function lbAddToCart() {
            const photos = getCurrentPhotos();
            const photo = photos[lbCurrentIndex];
            if (!photo) return;
            const licenseType = document.getElementById('lbLicenseSelect').value;
            const license = LICENSE_PRICES[licenseType];
            
            const existing = cart.find(item => item.photo_id === photo.id && item.license_type === licenseType);
            if (existing) {
                // Already in cart - go to cart page
                window.location.href = '/cart.html';
                return;
            }
            
            cart.push({
                photo_id: photo.id,
                license_type: licenseType,
                license: license.name,
                price: license.price,
                thumbnail: photo.thumbnail_url || photo.large_url,
                title: currentProject?.title || 'Photo',
                venue: currentProject?.venue || '',
                event_date: currentProject?.event_date ? formatDate(currentProject.event_date) : '',
                people: photo.people ? photo.people.join(', ') : ''
            });
            
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartUI();
            
            const btn = document.getElementById('lbAddCartBtn');
            btn.textContent = 'ADDED TO CART – VIEW CART';
            btn.classList.add('added');
        }
        
        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (!document.getElementById('lightbox').classList.contains('open')) return;
            if (e.key === 'Escape') closeLightbox();
            if (e.key === 'ArrowLeft') lbPrev();
            if (e.key === 'ArrowRight') lbNext();
        });
        
        // Download code state
        let activeDownloadCode = null;
        let dlModalPhotoIndex = null;
        let dlSelectedSize = 'high';
        
        function addAllToCart() {
            if (!currentProject || !currentProject.photos) return;
            
            let added = 0;
            currentProject.photos.forEach(photo => {
                const existing = cart.find(item => item.photo_id === photo.id);
                if (!existing) {
                    cart.push({
                        photo_id: photo.id,
                        license_type: 'web_editorial',
                        license: 'Web Editorial',
                        price: LICENSE_PRICES['web_editorial'].price,
                        thumbnail: photo.thumbnail_url || photo.large_url,
                        title: currentProject.title || 'Photo',
                        venue: currentProject.venue || '',
                        event_date: currentProject.event_date ? formatDate(currentProject.event_date) : '',
                        people: photo.people ? photo.people.join(', ') : '',
                        project_slug: currentProject.slug || ''
                    });
                    added++;
                }
            });
            
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartUI();
            showToast(added > 0 ? `${added} photos added to cart!` : 'All photos already in cart');
        }
        
        // Email collection for downloads
        let pendingDownloadAction = null; // 'single' or 'all'
        
        function getDownloadEmail() {
            return sessionStorage.getItem('downloadEmail');
        }
        
        function setDownloadEmail(email) {
            sessionStorage.setItem('downloadEmail', email);
        }
        
        function showEmailModal(action) {
            pendingDownloadAction = action;
            const emailInput = document.getElementById('downloadEmail');
            const errorEl = document.getElementById('emailError');
            const fallbackEl = document.getElementById('emailCodeFallback');
            const codeInput = document.getElementById('fallbackCodeInput');
            const codeStatus = document.getElementById('fallbackCodeStatus');
            
            if (emailInput) emailInput.value = '';
            if (errorEl) errorEl.classList.remove('show');
            if (fallbackEl) fallbackEl.classList.remove('show');
            if (codeInput) codeInput.value = '';
            if (codeStatus) codeStatus.textContent = '';
            
            document.getElementById('emailModal').classList.add('open');
            if (emailInput) emailInput.focus();
        }
        
        function closeEmailModal() {
            document.getElementById('emailModal').classList.remove('open');
            pendingDownloadAction = null;
        }
        
        function validateEmail(email) {
            return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
        }
        
        async function submitDownloadEmail() {
            const emailInput = document.getElementById('downloadEmail');
            const email = emailInput.value.trim();
            const errorEl = document.getElementById('emailError');
            const fallbackEl = document.getElementById('emailCodeFallback');
            const submitBtn = document.getElementById('emailSubmitBtn');
            
            if (!validateEmail(email)) {
                errorEl.textContent = 'Please enter a valid email address';
                errorEl.classList.add('show');
                return;
            }
            
            errorEl.classList.remove('show');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Checking...';
            
            try {
                // Check if email domain is whitelisted
                const response = await fetch(`${API_URL}/api/gallery-access/verify`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        project_id: currentProject.id,
                        email: email
                    })
                });
                
                const data = await response.json();
                
                if (data.valid) {
                    // Email approved! Set everything and download
                    setDownloadEmail(email);
                    activeDownloadCode = 'EMAIL:' + email;
                    closeEmailModal();
                    
                    // Continue with pending download action
                    if (pendingDownloadAction === 'single') {
                        proceedWithSingleDownload();
                    } else if (pendingDownloadAction === 'all') {
                        proceedWithAllDownload();
                    }
                } else {
                    // Email not approved - show code fallback
                    setDownloadEmail(email); // Still save email for logging
                    errorEl.textContent = 'Email not approved for free downloads';
                    errorEl.classList.add('show');
                    fallbackEl.classList.add('show');
                    document.getElementById('fallbackCodeInput').focus();
                }
            } catch (e) {
                console.error('Email verification error:', e);
                // On error, show code fallback
                setDownloadEmail(email);
                errorEl.textContent = 'Unable to verify email. Please enter client code.';
                errorEl.classList.add('show');
                fallbackEl.classList.add('show');
            }
            
            submitBtn.disabled = false;
            submitBtn.textContent = 'Continue';
        }
        
        async function submitFallbackCode() {
            const codeInput = document.getElementById('fallbackCodeInput');
            const statusEl = document.getElementById('fallbackCodeStatus');
            const code = codeInput.value.trim().toUpperCase();
            
            if (!code) {
                statusEl.textContent = 'Please enter a code';
                return;
            }
            
            statusEl.textContent = 'Checking...';
            
            try {
                // Verify code against project
                const response = await fetch(`${API_URL}/api/gallery-access/verify`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        project_id: currentProject.id,
                        code: code
                    })
                });
                
                const data = await response.json();
                
                if (data.valid) {
                    activeDownloadCode = code;
                    closeEmailModal();
                    
                    // Continue with pending download action
                    if (pendingDownloadAction === 'single') {
                        proceedWithSingleDownload();
                    } else if (pendingDownloadAction === 'all') {
                        proceedWithAllDownload();
                    }
                } else {
                    statusEl.textContent = 'Invalid code for this gallery';
                }
            } catch (e) {
                // Fallback: check against project's download_code directly
                if (currentProject.download_code?.toUpperCase() === code) {
                    activeDownloadCode = code;
                    closeEmailModal();
                    
                    if (pendingDownloadAction === 'single') {
                        proceedWithSingleDownload();
                    } else if (pendingDownloadAction === 'all') {
                        proceedWithAllDownload();
                    }
                } else {
                    statusEl.textContent = 'Invalid code';
                }
            }
        }
        
        // Handle Enter key in email input
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                const emailInput = document.getElementById('downloadEmail');
                if (emailInput) {
                    emailInput.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') submitDownloadEmail();
                    });
                }
                const codeInput = document.getElementById('fallbackCodeInput');
                if (codeInput) {
                    codeInput.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') submitFallbackCode();
                    });
                }
            }, 1000);
        });
        
        function downloadSinglePhoto(index) {
            if (!currentProject?.photos) return;
            dlModalPhotoIndex = index;
            
            // Check if already have download access
            if (activeDownloadCode) {
                proceedWithSingleDownload();
                return;
            }
            
            // Show email modal
            showEmailModal('single');
        }
        
        function downloadAllPhotos() {
            if (!currentProject?.photos) return;
            
            // Check if already have download access
            if (activeDownloadCode) {
                proceedWithAllDownload();
                return;
            }
            
            // Show email modal
            showEmailModal('all');
        }
        
        function proceedWithSingleDownload() {
            if (dlModalPhotoIndex === null) return;
            const photo = currentProject.photos[dlModalPhotoIndex];
            if (!photo) return;
            
            // Always use high resolution
            const url = photo.original_url || photo.large_url || photo.thumbnail_url;
            
            // Use the SF_XXXXXX filename if available, otherwise fallback
            const photoName = photo.photo_number || photo.filename?.replace(/\.[^.]+$/, '') || `photo-${dlModalPhotoIndex + 1}`;
            const extension = (photo.filename?.split('.').pop()) || 'jpg';
            const filename = `${photoName}.${extension}`;
            
            // Log the download to backend
            logDownload({
                photo_id: photo.id,
                filename: filename,
                resolution: 'High Resolution',
                download_type: 'single'
            });
            
            forceDownload(url, filename);
            dlModalPhotoIndex = null;
        }
        
        // Keep these for backwards compatibility but they won't be used
        function selectDlOption(size) {}
        function confirmDownload() {}
        
        async function logDownload(downloadInfo) {
            const email = getDownloadEmail();
            if (!email || !currentProject) return;
            
            try {
                await fetch(`${API_URL}/api/download-logs/log`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: email,
                        project_id: currentProject.id,
                        project_title: currentProject.title,
                        download_code: activeDownloadCode,
                        photo_id: downloadInfo.photo_id,
                        filename: downloadInfo.filename,
                        resolution: downloadInfo.resolution,
                        download_type: downloadInfo.download_type
                    })
                });
            } catch (e) {
                console.error('Failed to log download:', e);
            }
        }
        
        async function forceDownload(url, filename) {
            showToast('Preparing download...');
            
            // Use the backend as a download proxy to add Content-Disposition header
            // This is the most reliable way since R2 public URLs don't support CORS fetch
            const proxyUrl = `${API_URL}/api/download-proxy?url=${encodeURIComponent(url)}&filename=${encodeURIComponent(filename)}`;
            
            try {
                const response = await fetch(proxyUrl);
                if (!response.ok) throw new Error('Proxy failed');
                const blob = await response.blob();
                const blobUrl = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = blobUrl;
                link.download = filename;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                setTimeout(() => URL.revokeObjectURL(blobUrl), 1000);
                showToast('Download started!');
            } catch (e) {
                // Fallback: direct link (will open in browser but at least they get the image)
                showToast('Opening photo — right-click to save');
                window.open(url, '_blank');
            }
        }
        
        function closeDlModal() {
            document.getElementById('dlModal').classList.remove('open');
            dlModalPhotoIndex = null;
        }
        
        async function proceedWithAllDownload() {
            if (!currentProject?.photos) return;
            
            const btn = document.querySelector('.download-all-btn');
            const originalText = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg> Preparing ZIP...`;
            
            showToast(`Packaging ${currentProject.photos.length} photos into a ZIP...`);
            
            // Log the gallery download
            logDownload({
                photo_id: null,
                filename: `${currentProject.title || 'gallery'}.zip`,
                resolution: 'Full Gallery',
                download_type: 'gallery'
            });
            
            try {
                // Collect all photo URLs with proper SF_XXXXXX filenames
                const photos = currentProject.photos.map((photo, i) => {
                    const photoName = photo.photo_number || photo.filename?.replace(/\.[^.]+$/, '') || `photo-${String(i + 1).padStart(3, '0')}`;
                    const extension = (photo.filename?.split('.').pop()) || 'jpg';
                    return {
                        url: photo.original_url || photo.large_url || photo.thumbnail_url,
                        filename: `${photoName}.${extension}`
                    };
                });
                
                const response = await fetch(`${API_URL}/api/download-zip`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        photos: photos,
                        zipName: `${currentProject.title || 'gallery'}.zip`
                    })
                });
                
                if (!response.ok) throw new Error('ZIP creation failed');
                
                const blob = await response.blob();
                const blobUrl = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = blobUrl;
                link.download = `${currentProject.title || 'gallery'}.zip`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                setTimeout(() => URL.revokeObjectURL(blobUrl), 5000);
                
                showToast(`${currentProject.photos.length} photos downloaded as ZIP!`);
            } catch (e) {
                console.error('ZIP download failed:', e);
                showToast('ZIP failed — downloading individually...');
                // Fallback to individual downloads
                for (let i = 0; i < currentProject.photos.length; i++) {
                    const photo = currentProject.photos[i];
                    const url = photo.original_url || photo.large_url || photo.thumbnail_url;
                    const filename = `${currentProject.title || 'photo'}-${i + 1}.jpg`;
                    await forceDownload(url, filename);
                    await new Promise(resolve => setTimeout(resolve, 800));
                }
            }
            
            btn.disabled = false;
            btn.innerHTML = originalText;
        }
        
        function addToCart(photoId, licenseType, thumbnail) {
            const license = LICENSE_PRICES[licenseType];
            
            // Check if already in cart
            const existing = cart.find(item => item.photo_id === photoId && item.license_type === licenseType);
            if (existing) {
                showToast('Already in cart!');
                return;
            }
            
            cart.push({
                photo_id: photoId,
                license_type: licenseType,
                license: license.name,
                price: license.price,
                thumbnail: thumbnail,
                title: currentProject?.title || 'Photo',
                venue: currentProject?.venue || '',
                event_date: currentProject?.event_date ? formatDate(currentProject.event_date) : '',
                people: ''
            });
            
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartUI();
            showToast('Added to cart!');
        }
        
        function contactForPrint() {
            alert('For print licensing, please contact us at orders@sfeventphoto.com');
        }
        
        // ── Header Nav Functions ──
        function openMobileMenu() {
            document.getElementById('mobileMenu').classList.add('open');
            document.body.style.overflow = 'hidden';
        }

        function closeMobileMenu() {
            document.getElementById('mobileMenu').classList.remove('open');
            document.body.style.overflow = '';
        }

        function checkAuth() {
            const user = JSON.parse(localStorage.getItem('user'));
            const token = localStorage.getItem('token');
            if (user && token) {
                document.getElementById('signInLink').style.display = 'none';
                document.getElementById('userMenu').style.display = 'block';
                document.getElementById('userName').textContent = user.name || 'Account';
                document.getElementById('userEmail').textContent = user.email || '';
            }
        }

        function toggleUserMenu() {
            const dropdown = document.getElementById('userDropdown');
            dropdown.classList.toggle('show');
        }

        function signOut() {
            localStorage.removeItem('user');
            localStorage.removeItem('token');
            window.location.href = '/';
        }

        // Close user dropdown when clicking outside
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.user-menu')) {
                const dropdown = document.getElementById('userDropdown');
                if (dropdown) dropdown.classList.remove('show');
            }
        });

        function toggleCart() {
            document.getElementById('cartSidebar').classList.toggle('open');
            document.getElementById('cartOverlay').classList.toggle('open');
        }
        
        function removeFromCart(index) {
            cart.splice(index, 1);
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartUI();
        }
        
        function updateCartUI() {
            const cartItems = document.getElementById('cartItems');
            const cartCount = document.getElementById('cartCount');
            const cartTotal = document.getElementById('cartTotal');
            const checkoutBtn = document.getElementById('checkoutBtn');
            
            cartCount.textContent = cart.length;
            cartCount.classList.toggle('show', cart.length > 0);
            
            if (cart.length === 0) {
                cartItems.innerHTML = '<div class="empty-state"><p>Your cart is empty</p></div>';
                cartTotal.textContent = '$0.00';
                checkoutBtn.disabled = true;
                return;
            }
            
            let total = 0;
            cartItems.innerHTML = cart.map((item, index) => {
                total += item.price;
                return `
                    <div class="cart-item">
                        <img src="${item.thumbnail}" alt="" class="cart-item-image">
                        <div class="cart-item-info">
                            <div class="cart-item-title">${item.title}</div>
                            <div class="cart-item-license">${item.license} License</div>
                            <div class="cart-item-price">$${(item.price / 100).toFixed(2)}</div>
                        </div>
                        <button class="cart-item-remove" onclick="removeFromCart(${index})">&times;</button>
                    </div>
                `;
            }).join('');
            
            cartTotal.textContent = `$${(total / 100).toFixed(2)}`;
            checkoutBtn.disabled = false;
        }
        
        async function checkout() {
            if (cart.length === 0) return;
            
            const checkoutBtn = document.getElementById('checkoutBtn');
            checkoutBtn.disabled = true;
            checkoutBtn.textContent = 'Processing...';
            
            try {
                const email = prompt('Enter your email address:');
                if (!email) {
                    checkoutBtn.disabled = false;
                    checkoutBtn.textContent = 'Proceed to Checkout';
                    return;
                }
                
                const response = await fetch(`${API_URL}/api/checkout/create-session`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        items: cart.map(item => ({
                            photo_id: item.photo_id,
                            license_type: item.license_type
                        })),
                        customer_email: email
                    })
                });
                
                const data = await response.json();
                
                if (data.error) throw new Error(data.error);
                
                // Clear cart and redirect to Stripe
                localStorage.removeItem('cart');
                window.location.href = data.url;
            } catch (error) {
                console.error('Checkout error:', error);
                alert('Checkout failed: ' + error.message);
                checkoutBtn.disabled = false;
                checkoutBtn.textContent = 'Proceed to Checkout';
            }
        }
        
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 2000);
        }
        
        function formatDate(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        }
        
        function formatDateLong(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: '2-digit', year: 'numeric' });
        }
        
        function formatDateRange(startDate, endDate) {
            if (!startDate) return '';
            const start = new Date(startDate);
            const startMonth = start.toLocaleDateString('en-US', { month: 'short' });
            const startDay = start.getDate();
            const startYear = start.getFullYear();
            
            if (!endDate) {
                return `${startMonth} ${startDay}, ${startYear}`;
            }
            
            const end = new Date(endDate);
            const endMonth = end.toLocaleDateString('en-US', { month: 'short' });
            const endDay = end.getDate();
            const endYear = end.getFullYear();
            
            if (startMonth === endMonth && startYear === endYear) {
                return `${startMonth} ${startDay}-${endDay}, ${startYear}`;
            }
            if (startYear === endYear) {
                return `${startMonth} ${startDay} - ${endMonth} ${endDay}, ${startYear}`;
            }
            return `${startMonth} ${startDay}, ${startYear} - ${endMonth} ${endDay}, ${endYear}`;
        }
        
        // Set orientation class based on actual image dimensions
        // Update SEO meta tags dynamically for better search engine visibility
        function updateSEO(project) {
            // Build description with venue, tags, and date
            const tags = project.tags || [];
            const tagText = tags.length ? tags.join(', ') + ' photography' : 'event photography';
            const venueText = project.venue ? ` at ${project.venue}` : '';
            const dateText = project.event_date ? ` - ${formatDateRange(project.event_date, project.event_end_date)}` : '';
            
            const description = `${project.title}${venueText}${dateText}. Professional ${tagText} by SF Event Photo.`;
            
            // Update meta description
            let metaDesc = document.querySelector('meta[name="description"]');
            if (metaDesc) metaDesc.setAttribute('content', description);
            
            // Update Open Graph tags
            const ogTitle = document.getElementById('og-title');
            const ogDesc = document.getElementById('og-description');
            const ogImage = document.getElementById('og-image');
            const ogUrl = document.getElementById('og-url');
            
            if (ogTitle) ogTitle.setAttribute('content', `${project.title} - SF Event Photo`);
            if (ogDesc) ogDesc.setAttribute('content', description);
            if (ogImage && project.cover_image_url) ogImage.setAttribute('content', project.cover_image_url);
            if (ogUrl) ogUrl.setAttribute('content', window.location.href);
            
            // Update Twitter tags
            const twitterTitle = document.getElementById('twitter-title');
            const twitterDesc = document.getElementById('twitter-description');
            const twitterImage = document.getElementById('twitter-image');
            
            if (twitterTitle) twitterTitle.setAttribute('content', `${project.title} - SF Event Photo`);
            if (twitterDesc) twitterDesc.setAttribute('content', description);
            if (twitterImage && project.cover_image_url) twitterImage.setAttribute('content', project.cover_image_url);
            
            // Update Schema.org structured data
            const schemaScript = document.getElementById('schema-data');
            if (schemaScript) {
                const schema = {
                    "@context": "https://schema.org",
                    "@type": "ImageGallery",
                    "name": project.title,
                    "description": description,
                    "url": window.location.href,
                    "numberOfItems": project.photo_count || 0,
                    "dateCreated": project.event_date || undefined,
                    "locationCreated": project.venue ? {
                        "@type": "Place",
                        "name": project.venue
                    } : undefined,
                    "keywords": [...tags, project.venue, 'event photography', 'SF Event Photo'].filter(Boolean).join(', '),
                    "creator": {
                        "@type": "Organization",
                        "name": "SF Event Photo",
                        "url": "https://sfeventphoto.com"
                    },
                    "provider": {
                        "@type": "ProfessionalService",
                        "name": "SF Event Photo",
                        "url": "https://sfeventphoto.com"
                    }
                };
                schemaScript.textContent = JSON.stringify(schema);
            }
        }
        
        function setOrientation(img, cardId) {
            const card = document.getElementById(cardId);
            if (!card) return;
            
            const ratio = img.naturalWidth / img.naturalHeight;
            
            if (ratio > 1.2) {
                card.classList.add('landscape');
            } else if (ratio < 0.8) {
                card.classList.add('portrait');
            } else {
                card.classList.add('square');
            }
        }
    </script>
    
    <!-- Video Modal -->
    <div class="video-modal" id="videoModal" onclick="closeVideoModal(event)">
        <div class="video-modal-content" onclick="event.stopPropagation()">
            <button class="video-modal-close" onclick="closeVideoModal()">&times;</button>
            <iframe id="videoIframe" src="" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen></iframe>
        </div>
    </div>
</body>
</html>
